<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Production Data</title>
  <style>
    :root{
      --pri-blue:#25408F; --pri-green:#92D050; --bg:#E9EDF5; --card:#FBFCFE; --ink:#0F172A; --muted:#475569;
      --ok:#11A85B; --warn:#F59E0B; --bad:#D32F2F; --ok-ink:#042915; --warn-ink:#3B2600; --bad-ink:#2B0B0B;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif}
    .top-border{position:fixed;top:0;left:0;width:100%;height:96px;background:var(--pri-green);z-index:10;display:flex;align-items:center}
    .top-border .logo{height:72px;margin-left:16px}
    .top-title{font-size:28px;font-weight:900;letter-spacing:.2px;margin-left:20px;color:#0A2A12}
    .tabs{margin-left:auto;margin-right:160px;display:flex;gap:8px}
    .tab{background:#ffffffd9;border:1px solid #ffffff; padding:8px 12px;border-radius:10px;text-decoration:none;color:#0A2A12;font-weight:700}
    .tab.active{background:#fff}
    .right-top-image{position:fixed;top:0;right:0;padding:10px}
    .right-top-image img{height:75px}
    .left-border{position:fixed;top:0;left:0;width:128px;height:100%;background:var(--pri-green);z-index:5}
    .left-border .side-title{writing-mode:vertical-rl;transform:rotate(180deg);font-weight:900;letter-spacing:2px;color:#0A2A12;margin:140px auto 0;opacity:.9}
    .wrap{position:relative;z-index:1;margin:120px 20px 20px 160px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:0 0 14px}
    select,button{padding:8px 10px;border-radius:10px;border:1px solid #CBD5E1;background:#fff}
    .kpis{display:flex;flex-wrap:wrap;gap:10px}
    .tile{background:var(--card);padding:12px 14px;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.10);min-width:170px;border:1px solid #DEE3F0}
    .tile .lab{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
    .tile .val{font-size:24px;font-weight:900}
    .tile.good{background:linear-gradient(180deg,#E9FFF4,#D1F7E4);color:var(--ok-ink);border-color:#A7E8C7}
    .tile.warn{background:linear-gradient(180deg,#FFF6E5,#FFE7BF);color:var(--warn-ink);border-color:#F5C979}
    .tile.bad{ background:linear-gradient(180deg,#FFE9E9,#FFD4D4);color:var(--bad-ink); border-color:#F19C9C}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:1200px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:820px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#F7F9FF,#F1F5FE);border:1px solid #D7DFF3;border-radius:16px;box-shadow:0 2px 10px rgba(0,20,60,.12);padding:14px;display:grid;grid-template-columns:240px 1fr;gap:12px}
    .card h3{margin:0 0 4px;font-size:20px}
    .meta{font-size:12px;color:var(--muted)}
    .badges{display:flex;gap:8px;margin-top:6px}
    .badge{padding:3px 10px;border-radius:999px;font-weight:800;font-size:12px;border:1px solid #0002}
    .badge.maint{background:#FEE8A6;color:#3B2F0A}
    .badge.prod {background:#DBE6FF;color:#0D246F}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:stretch}
    .col{flex:1 1 220px}
    .speedos{display:flex;gap:12px}
    .speedo{width:140px;height:80px;position:relative}
    .speedo .cap{position:absolute;width:100%;text-align:center;bottom:-2px;font-size:11px;color:var(--muted);font-weight:700}
    .spark{height:44px;width:180px}
    .spark svg{width:100%;height:100%}
    .heatmap{margin-top:16px}
    table{width:100%;border-collapse:collapse;background:#F7FAFF;border:1px solid #D7E0F3;border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #E1E9F8;text-align:center}
    th{background:var(--pri-blue);color:#fff;position:sticky;top:0}
    .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:var(--muted)}
    .sw{display:inline-block;width:12px;height:12px;border-radius:3px;margin-right:4px}
    .footer{position:fixed;bottom:0;left:128px;right:0;height:28px;background:var(--pri-blue);color:#fff;display:flex;align-items:center;justify-content:flex-end;padding:0 12px;font-size:12px;letter-spacing:.3px}
  </style>
</head>
<body>
  <div class="top-border">
    <img src="img/pri-logo.png" alt="PRI Logo" class="logo" />
    <div class="top-title">Production Data</div>
    <div class="tabs">
      <a class="tab" href="index.html">Work Orders</a>
      <a class="tab" href="pm.html">PM</a>
      <a class="tab" href="prodstatus.html">Prod Status</a>
      <a class="tab" href="kpi-by-asset.html">KPIs by Asset</a>
      <a class="tab active" href="#">Production</a>
      <a class="tab" href="productionv2.html">Production V2</a>
      <a class="tab" href="admin">Admin</a>
    </div>
  </div>
  <div class="right-top-image"><img src="img/innovation-logo.png" alt="Innovation" /></div>
  <div class="left-border"><div class="side-title">PRI • KPIs</div></div>

  <div class="wrap">
    <div class="controls">
      <label style="font-weight:800">Timeframe</label>
      <select id="timeframe">
        <option value="lastMonth" selected>Last Month</option>
        <option value="currentMonth">Current Month</option>
        <option value="trailing30">Trailing 30 Days</option>
        <option value="trailing7">Trailing 7 Days</option>
      </select>
      <button id="refresh">Refresh</button>
      <span id="daterange" class="meta"></span>
    </div>

    <section>
      <h2 style="margin:8px 0">All Lines — Overall</h2>
      <div id="overall" class="kpis"></div>
    </section>

    <section style="margin-top:16px">
      <h2 style="margin:8px 0">Lines 1–9</h2>
      <div id="cards" class="grid"></div>
    </section>

    <section class="heatmap">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 style="margin:8px 0">Weekday Heatmap (OEE)</h2>
        <div class="legend">
          <span><span class="sw" style="background:#BDEFD2"></span>Good</span>
          <span><span class="sw" style="background:#FFE3A6"></span>Warn</span>
          <span><span class="sw" style="background:#FFC0C0"></span>Bad</span>
        </div>
      </div>
      <div id="heat"></div>
    </section>
  </div>

  <div class="footer">PRI • Production Dashboard</div>

<script>
const THRESH = { capacityAdj:{good:0.95,warn:0.85}, oee:{good:0.75,warn:0.60}, availability:{good:0.90,warn:0.80}, quality:{good:0.99,warn:0.98} };
const LINES = [
  { id:"LINE_1", name:"Line 1", hourlyCapacityLbs: 4200 },
  { id:"LINE_2", name:"Line 2", hourlyCapacityLbs: 3800 },
  { id:"LINE_3", name:"Line 3", hourlyCapacityLbs: 4100 },
  { id:"LINE_4", name:"Line 4", hourlyCapacityLbs: 3600 },
  { id:"LINE_5", name:"Line 5", hourlyCapacityLbs: 4000 },
  { id:"LINE_6", name:"Line 6", hourlyCapacityLbs: 4400 },
  { id:"LINE_7", name:"Line 7", hourlyCapacityLbs: 3950 },
  { id:"LINE_8", name:"Line 8", hourlyCapacityLbs: 3700 },
  { id:"LINE_9", name:"Line 9", hourlyCapacityLbs: 4300 }
];
const SAMPLE_ROWS = [
  ["2025-08-23","STOCK 25/2","PL003629","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-08-23","STOCK 25/2","PL003661","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-08-24","STOCK 25/2","PL003662","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-08-24","STOCK 25/2","PL003663","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-08-25","STOCK 25/2","PL003664","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-08-27","COPP 20-03","PL003555","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-09-04","PP SAMPLE","PL003734","3 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-09-04","PP SAMPLE","PL003735","3 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""],
  ["2025-09-10","STOCK 25/2","PL003675","28 (1500)","NEW NON LOGO BOXES","PP","BLK","PEL",""]
];
function mockMaintHours(dateStr,lineId){const seed=[...dateStr+lineId].reduce((a,c)=>a+c.charCodeAt(0),0);return (seed%7)*0.6}
function estimateRuntimeHours(lbs,cap){return Math.min(24,lbs/Math.max(1,cap))}
function parseCountToPounds(t){const m=String(t).match(/(\d+)\s*\(\s*(\d+)\s*\)/);return m?parseInt(m[1])*parseInt(m[2]):0}
const SHIFTS=["A","B","C"];
function buildDemoData(){
  const byKey={};
  for(const r of SAMPLE_ROWS){
    const [d,customer,lot,countTxt]=r; const lbs=parseCountToPounds(countTxt);
    const line=LINES[(lot.charCodeAt(5)+lot.charCodeAt(6))%LINES.length];
    const shift=SHIFTS[(lot.charCodeAt(7))%3];
    const key=`${line.id}|${d}`; if(!byKey[key]) byKey[key]={line,date:d,producedLbs:0,shifts:{}};
    byKey[key].producedLbs+=lbs; byKey[key].shifts[shift]=(byKey[key].shifts[shift]||0)+lbs;
  }
  return Object.values(byKey).map(rec=>{
    const maint=mockMaintHours(rec.date,rec.line.id); const runtime=estimateRuntimeHours(rec.producedLbs,rec.line.hourlyCapacityLbs);
    const prodDT=Math.max(0,24-maint-runtime); const totalDT=maint+prodDT; const availability=(24-totalDT)/24;
    const perfRaw=rec.producedLbs/(rec.line.hourlyCapacityLbs*24); const perfAdj=rec.producedLbs/(rec.line.hourlyCapacityLbs*Math.max(1,24-totalDT));
    const quality=1.0; const oee=availability*perfAdj*quality; const lbsPerHr=rec.producedLbs/Math.max(1,runtime);
    return {...rec,maintDT:maint,prodDT,totalDT,availability,perfRaw,perfAdj,quality,oee,runtimeHours:runtime,lbsPerHr};
  })
}
function clsBy(v,{good,warn}){return v>=good?'good':v>=warn?'warn':'bad'}
function formatPct(x){return isFinite(x)?(x*100).toFixed(0)+"%":"--%"}
function formatLbs(x){return isFinite(x)?x.toLocaleString()+" lb":"-- lb"}
function formatLbsHr(x){return isFinite(x)?x.toFixed(0)+" lb/hr":"-- lb/hr"}
function speedoSVG(value){const pct=Math.max(0,Math.min(1,value));const s=Math.PI,e=Math.PI*(1-pct);const R=54,cx=70,cy=72;const sx=cx+R*Math.cos(s),sy=cy+R*Math.sin(s);const ex=cx+R*Math.cos(e),ey=cy+R*Math.sin(e);const L=pct>0.5?1:0;return `<svg viewBox="0 0 140 90" xmlns="http://www.w3.org/2000/svg"><path d="M ${cx-R} ${cy} A ${R} ${R} 0 1 1 ${cx+R} ${cy}" fill="none" stroke="#CBD5E1" stroke-width="12"/><path d="M ${sx} ${sy} A ${R} ${R} 0 ${L} 1 ${ex} ${ey}" fill="none" stroke="#0B1220" stroke-width="12" stroke-linecap="round"/><text x="70" y="56" text-anchor="middle" font-size="20" font-weight="900">${formatPct(pct)}</text></svg>`}
function sparkSVG(shifts){const vals=SHIFTS.map(s=>shifts[s]||0);const max=Math.max(1,...vals);const w=180,h=44,bw=(w-10)/vals.length;let bars='';vals.forEach((v,i)=>{const bh=Math.max(3,(v/max)*(h-10));const x=5+i*bw,y=h-bh-5;bars+=`<rect x="${x}" y="${y}" width="${bw-6}" height="${bh}" rx="4" fill="#27408F" />`});return `<svg viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">${bars}</svg>`}
function tile(label,value,cls=''){const d=document.createElement('div');d.className=`tile ${cls}`;d.innerHTML=`<div class="lab">${label}</div><div class="val">${value}</div>`;return d}
function cardForLine(line,r){const c=document.createElement('div');c.className='card';const header=document.createElement('div');header.innerHTML=`<h3>${line.name}</h3><div class="meta">Nameplate: ${line.hourlyCapacityLbs.toLocaleString()} lb/hr</div>`;const body=document.createElement('div');const oeeCls=r?clsBy(r.oee,THRESH.oee):'';const availCls=r?clsBy(r.availability,THRESH.availability):'';const prCls=r?clsBy(r.perfRaw,THRESH.capacityAdj):'';const paCls=r?clsBy(r.perfAdj,THRESH.capacityAdj):'';const left=document.createElement('div');left.className='row';left.innerHTML=`<div class="col"><div class="tile ${oeeCls}"><div class="lab">OEE</div><div class="val">${r?formatPct(r.oee):'--%'}</div></div><div class="badges"><span class="badge maint">Maint DT ${r?r.maintDT.toFixed(1):'-'}h</span><span class="badge prod">Prod DT ${r?r.prodDT.toFixed(1):'-'}h</span></div></div><div class="col"><div class="tile ${availCls}"><div class="lab">Availability</div><div class="val">${r?formatPct(r.availability):'--%'}</div></div><div class="tile"><div class="lab">Run Rate</div><div class="val">${r?formatLbsHr(r.lbsPerHr):'--'}</div></div></div>`;const right=document.createElement('div');right.innerHTML=`<div class="speedos"><div class="speedo">${speedoSVG(r?r.perfRaw:0)}<div class="cap">Capacity (Raw 24h)</div></div><div class="speedo">${speedoSVG(r?r.perfAdj:0)}<div class="cap">Capacity (Adj for DT)</div></div></div><div class="row" style="margin-top:8px"><div class="tile ${prCls}"><div class="lab">Perf Raw</div><div class="val">${r?formatPct(r.perfRaw):'--%'}</div></div><div class="tile ${paCls}"><div class="lab">Perf Adj</div><div class="val">${r?formatPct(r.perfAdj):'--%'}</div></div><div class="tile"><div class="lab">Pounds</div><div class="val">${r?formatLbs(r.producedLbs):'--'}</div></div><div class="tile"><div class="lab">Quality</div><div class="val">${r?formatPct(r.quality):'--%'}</div></div></div><div class="spark">${sparkSVG(r?r.shifts:{})}</div>`;body.appendChild(left);body.appendChild(right);c.appendChild(header);c.appendChild(body);return c}
function render(){const data=buildDemoData();const overall=data.reduce((a,r)=>({produced:a.produced+r.producedLbs,maint:a.maint+r.maintDT,prod:a.prod+r.prodDT}),{produced:0,maint:0,prod:0});const totalDT=overall.maint+overall.prod;const availability=(data.length?(24*data.length-totalDT)/(24*data.length):0);const avgCap=LINES.reduce((a,l)=>a+l.hourlyCapacityLbs,0)/LINES.length;const perfRaw=overall.produced/((24*data.length)*avgCap);const perfAdj=overall.produced/(Math.max(1,(24*data.length-totalDT))*avgCap);const oee=availability*perfAdj*1.0;const ov=document.getElementById('overall');ov.innerHTML='';ov.appendChild(tile('OEE',formatPct(oee),clsBy(oee,THRESH.oee)));ov.appendChild(tile('Availability',formatPct(availability),clsBy(availability,THRESH.availability)));ov.appendChild(tile('Performance (Raw 24h)',formatPct(perfRaw),clsBy(perfRaw,THRESH.capacityAdj)));ov.appendChild(tile('Performance (Adj for DT)',formatPct(perfAdj),clsBy(perfAdj,THRESH.capacityAdj)));ov.appendChild(tile('Total Pounds',formatLbs(overall.produced)));ov.appendChild(tile('Maint DT (h)',overall.maint.toFixed(1)));ov.appendChild(tile('Prod DT (h)',overall.prod.toFixed(1)));const latest={};data.forEach(r=>latest[r.line.id]=r);const cards=document.getElementById('cards');cards.innerHTML='';for(const line of LINES){cards.appendChild(cardForLine(line,latest[line.id]))}const hm=document.getElementById('heat');const days=['Mon','Tue','Wed','Thu','Fri'];let html='<table><thead><tr><th>Line</th>'+days.map(d=>`<th>${d}</th>`).join('')+'</tr></thead><tbody>';for(const line of LINES){html+=`<tr><td style="text-align:left;font-weight:900">${line.name}</td>`;for(const d of days){const val=(latest[line.id]?.oee??Math.random());const c=clsBy(val,THRESH.oee);const bg=c==='good'?'#BDEFD2':c==='warn'?'#FFE3A6':'#FFC0C0';html+=`<td style="background:${bg};font-weight:800">${formatPct(val)}</td>`}html+='</tr>'}html+='</tbody></table>';hm.innerHTML=html}
render();
document.getElementById('refresh').addEventListener('click',render);
</script>
</body>
</html>
